{"version":3,"file":"index.js","sourceRoot":"/","sources":["index.ts"],"names":[],"mappings":"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","sourcesContent":["import puppeteer, { Page, Browser } from 'puppeteer'\r\nimport treeKill from 'tree-kill';\r\n\r\nimport blockedHostsList from './blocked-hosts';\r\n\r\nimport { getDurationInDays, formatDate, getCleanText, getLocationFromText, statusLog, getHostname } from './utils'\r\nimport { SessionExpired } from './errors';\r\n\r\nexport interface Location {\r\n  city: string | null;\r\n  province: string | null;\r\n  country: string | null\r\n}\r\n\r\ninterface RawProfile {\r\n  fullName: string | null;\r\n  title: string | null;\r\n  location: string | null;\r\n  photo: string | null;\r\n  description: string | null;\r\n  url: string;\r\n}\r\n\r\nexport interface Profile {\r\n  fullName: string | null;\r\n  title: string | null;\r\n  location: Location | null;\r\n  photo: string | null;\r\n  description: string | null;\r\n  url: string;\r\n}\r\n\r\ninterface RawExperience {\r\n  title: string | null;\r\n  company: string | null;\r\n  employmentType: string | null;\r\n  location: string | null;\r\n  startDate: string | null;\r\n  endDate: string | null;\r\n  endDateIsPresent: boolean;\r\n  description: string | null;\r\n}\r\n\r\nexport interface Experience {\r\n  title: string | null;\r\n  company: string | null;\r\n  employmentType: string | null;\r\n  location: Location | null;\r\n  startDate: string | null;\r\n  endDate: string | null;\r\n  endDateIsPresent: boolean;\r\n  durationInDays: number | null;\r\n  description: string | null;\r\n}\r\n\r\ninterface RawEducation {\r\n  schoolName: string | null;\r\n  degreeName: string | null;\r\n  fieldOfStudy: string | null;\r\n  startDate: string | null;\r\n  endDate: string | null;\r\n}\r\n\r\nexport interface Education {\r\n  schoolName: string | null;\r\n  degreeName: string | null;\r\n  fieldOfStudy: string | null;\r\n  startDate: string | null;\r\n  endDate: string | null;\r\n  durationInDays: number | null;\r\n}\r\n\r\ninterface RawVolunteerExperience {\r\n  title: string | null;\r\n  company: string | null;\r\n  startDate: string | null;\r\n  endDate: string | null;\r\n  endDateIsPresent: boolean;\r\n  description: string | null;\r\n}\r\n\r\nexport interface VolunteerExperience {\r\n  title: string | null;\r\n  company: string | null;\r\n  startDate: string | null;\r\n  endDate: string | null;\r\n  endDateIsPresent: boolean;\r\n  durationInDays: number | null;\r\n  description: string | null;\r\n}\r\n\r\nexport interface Skill {\r\n  skillName: string | null;\r\n  endorsementCount: number | null;\r\n}\r\n\r\ninterface ScraperUserDefinedOptions {\r\n  /**\r\n   * The LinkedIn `li_at` session cookie value. Get this value by logging in to LinkedIn with the account you want to use for scraping.\r\n   * Open your browser's Dev Tools and find the cookie with the name `li_at`. Use that value here.\r\n   * \r\n   * This script uses a known session cookie of a successful login into LinkedIn, instead of an e-mail and password to set you logged in. \r\n   * I did this because LinkedIn has security measures by blocking login requests from unknown locations or requiring you to fill in Captcha's upon login.\r\n   * So, if you run this from a server and try to login with an e-mail address and password, your login could be blocked. \r\n   * By using a known session, we prevent this from happening and allows you to use this scraper on any server on any location.\r\n   * \r\n   * You probably need to get a new session cookie value when the scraper logs show it's not logged in anymore.\r\n   */\r\n  sessionCookieValue: string;\r\n  /**\r\n   * Set to true if you want to keep the scraper session alive. This results in faster recurring scrapes.\r\n   * But keeps your memory usage high.\r\n   * \r\n   * Default: `false`\r\n   */\r\n  keepAlive?: boolean;\r\n  /**\r\n   * Set a custom user agent if you like.\r\n   * \r\n   * Default: `Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36`\r\n   */\r\n  userAgent?: string;\r\n  /**\r\n   * Use a custom timeout to set the maximum time you want to wait for the scraper \r\n   * to do his job.\r\n   * \r\n   * Default: `10000` (10 seconds)\r\n   */\r\n  timeout?: number;\r\n  /**\r\n   * Start the scraper in headless mode, or not.\r\n   * \r\n   * Default: `true`\r\n   */\r\n  headless?: boolean;\r\n}\r\n\r\ninterface ScraperOptions {\r\n  sessionCookieValue: string;\r\n  keepAlive: boolean;\r\n  userAgent: string;\r\n  timeout: number;\r\n  headless: boolean;\r\n}\r\n\r\nasync function autoScroll(page: Page) {\r\n  await page.evaluate(() => {\r\n    return new Promise((resolve, reject) => {\r\n      var totalHeight = 0;\r\n      var distance = 500;\r\n      var timer = setInterval(() => {\r\n        var scrollHeight = document.body.scrollHeight;\r\n        window.scrollBy(0, distance);\r\n        totalHeight += distance;\r\n\r\n        if (totalHeight >= scrollHeight) {\r\n          clearInterval(timer);\r\n          resolve(true);\r\n        }\r\n      }, 100);\r\n    });\r\n  });\r\n}\r\n\r\nexport class LinkedInProfileScraper {\r\n  readonly options: ScraperOptions = {\r\n    sessionCookieValue: '',\r\n    keepAlive: false,\r\n    timeout: 10000,\r\n    userAgent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36',\r\n    headless: true\r\n  }\r\n\r\n  private browser: Browser | null = null;\r\n\r\n  constructor(userDefinedOptions: ScraperUserDefinedOptions) {\r\n    const logSection = 'constructing';\r\n    const errorPrefix = 'Error during setup.';\r\n\r\n    if (!userDefinedOptions.sessionCookieValue) {\r\n      throw new Error(`${errorPrefix} Option \"sessionCookieValue\" is required.`);\r\n    }\r\n\r\n    if (userDefinedOptions.sessionCookieValue && typeof userDefinedOptions.sessionCookieValue !== 'string') {\r\n      throw new Error(`${errorPrefix} Option \"sessionCookieValue\" needs to be a string.`);\r\n    }\r\n\r\n    if (userDefinedOptions.userAgent && typeof userDefinedOptions.userAgent !== 'string') {\r\n      throw new Error(`${errorPrefix} Option \"userAgent\" needs to be a string.`);\r\n    }\r\n\r\n    if (userDefinedOptions.keepAlive !== undefined && typeof userDefinedOptions.keepAlive !== 'boolean') {\r\n      throw new Error(`${errorPrefix} Option \"keepAlive\" needs to be a boolean.`);\r\n    }\r\n\r\n    if (userDefinedOptions.timeout !== undefined && typeof userDefinedOptions.timeout !== 'number') {\r\n      throw new Error(`${errorPrefix} Option \"timeout\" needs to be a number.`);\r\n    }\r\n\r\n    if (userDefinedOptions.headless !== undefined && typeof userDefinedOptions.headless !== 'boolean') {\r\n      throw new Error(`${errorPrefix} Option \"headless\" needs to be a boolean.`);\r\n    }\r\n\r\n    this.options = Object.assign(this.options, userDefinedOptions);\r\n\r\n    statusLog(logSection, `Using options: ${JSON.stringify(this.options)}`);\r\n  }\r\n\r\n  /**\r\n   * Method to load Puppeteer in memory so we can re-use the browser instance.\r\n   */\r\n  public setup = async () => {\r\n    const logSection = 'setup'\r\n\r\n    try {\r\n      statusLog(logSection, `Launching puppeteer in the ${this.options.headless ? 'background' : 'foreground'}...`)\r\n\r\n      this.browser = await puppeteer.launch({\r\n        headless: this.options.headless,\r\n        args: [\r\n          ...(this.options.headless ? '---single-process' : '---start-maximized'),\r\n          '--no-sandbox',\r\n          '--disable-setuid-sandbox',\r\n          \"--proxy-server='direct://\",\r\n          '--proxy-bypass-list=*',\r\n          '--disable-dev-shm-usage',\r\n          '--disable-accelerated-2d-canvas',\r\n          '--disable-gpu',\r\n          '--disable-features=site-per-process',\r\n          '--enable-features=NetworkService',\r\n          '--allow-running-insecure-content',\r\n          '--enable-automation',\r\n          '--disable-background-timer-throttling',\r\n          '--disable-backgrounding-occluded-windows',\r\n          '--disable-renderer-backgrounding',\r\n          '--disable-web-security',\r\n          '--autoplay-policy=user-gesture-required',\r\n          '--disable-background-networking',\r\n          '--disable-breakpad',\r\n          '--disable-client-side-phishing-detection',\r\n          '--disable-component-update',\r\n          '--disable-default-apps',\r\n          '--disable-domain-reliability',\r\n          '--disable-extensions',\r\n          '--disable-features=AudioServiceOutOfProcess',\r\n          '--disable-hang-monitor',\r\n          '--disable-ipc-flooding-protection',\r\n          '--disable-notifications',\r\n          '--disable-offer-store-unmasked-wallet-cards',\r\n          '--disable-popup-blocking',\r\n          '--disable-print-preview',\r\n          '--disable-prompt-on-repost',\r\n          '--disable-speech-api',\r\n          '--disable-sync',\r\n          '--disk-cache-size=33554432',\r\n          '--hide-scrollbars',\r\n          '--ignore-gpu-blacklist',\r\n          '--metrics-recording-only',\r\n          '--mute-audio',\r\n          '--no-default-browser-check',\r\n          '--no-first-run',\r\n          '--no-pings',\r\n          '--no-zygote',\r\n          '--password-store=basic',\r\n          '--use-gl=swiftshader',\r\n          '--use-mock-keychain'\r\n        ],\r\n        timeout: this.options.timeout\r\n      })\r\n\r\n      statusLog(logSection, 'Puppeteer launched!')\r\n\r\n      await this.checkIfLoggedIn();\r\n\r\n      statusLog(logSection, 'Done!')\r\n    } catch (err) {\r\n      // Kill Puppeteer\r\n      await this.close();\r\n\r\n      statusLog(logSection, 'An error occurred during setup.')\r\n\r\n      throw err\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Create a Puppeteer page with some extra settings to speed up the crawling process.\r\n   */\r\n  private createPage = async (): Promise<Page> => {\r\n    const logSection = 'setup page'\r\n\r\n    if (!this.browser) {\r\n      throw new Error('Browser not set.');\r\n    }\r\n\r\n    // Important: Do not block \"stylesheet\", makes the crawler not work for LinkedIn\r\n    const blockedResources = ['image', 'media', 'font', 'texttrack', 'object', 'beacon', 'csp_report', 'imageset'];\r\n\r\n    try {\r\n      const page = await this.browser.newPage()\r\n\r\n      // Use already open page\r\n      // This makes sure we don't have an extra open tab consuming memory\r\n      const firstPage = (await this.browser.pages())[0];\r\n      await firstPage.close();\r\n\r\n      // Method to create a faster Page\r\n      // From: https://github.com/shirshak55/scrapper-tools/blob/master/src/fastPage/index.ts#L113\r\n      const session = await page.target().createCDPSession()\r\n      await page.setBypassCSP(true)\r\n      await session.send('Page.enable');\r\n      await session.send('Page.setWebLifecycleState', {\r\n        state: 'active',\r\n      });\r\n\r\n      statusLog(logSection, `Blocking the following resources: ${blockedResources.join(', ')}`)\r\n\r\n      // A list of hostnames that are trackers\r\n      // By blocking those requests we can speed up the crawling\r\n      // This is kinda what a normal adblocker does, but really simple\r\n      const blockedHosts = this.getBlockedHosts();\r\n      const blockedResourcesByHost = ['script', 'xhr', 'fetch', 'document']\r\n\r\n      statusLog(logSection, `Should block scripts from ${Object.keys(blockedHosts).length} unwanted hosts to speed up the crawling.`);\r\n\r\n      // Block loading of resources, like images and css, we dont need that\r\n      await page.setRequestInterception(true);\r\n\r\n      page.on('request', (req) => {\r\n        if (blockedResources.includes(req.resourceType())) {\r\n          return req.abort()\r\n        }\r\n\r\n        const hostname = getHostname(req.url());\r\n\r\n        // Block all script requests from certain host names\r\n        if (blockedResourcesByHost.includes(req.resourceType()) && hostname && blockedHosts[hostname] === true) {\r\n          statusLog('blocked script', `${req.resourceType()}: ${hostname}: ${req.url()}`);\r\n          return req.abort();\r\n        }\r\n\r\n        return req.continue()\r\n      })\r\n\r\n      await page.setUserAgent(this.options.userAgent)\r\n\r\n      await page.setViewport({\r\n        width: 1200,\r\n        height: 720\r\n      })\r\n\r\n      statusLog(logSection, `Setting session cookie using cookie: ${process.env.LINKEDIN_SESSION_COOKIE_VALUE}`)\r\n\r\n      await page.setCookie({\r\n        'name': 'li_at',\r\n        'value': this.options.sessionCookieValue,\r\n        'domain': '.www.linkedin.com'\r\n      })\r\n\r\n      statusLog(logSection, 'Session cookie set!')\r\n\r\n      statusLog(logSection, 'Done!')\r\n\r\n      return page;\r\n    } catch (err) {\r\n      // Kill Puppeteer\r\n      await this.close();\r\n\r\n      statusLog(logSection, 'An error occurred during page setup.')\r\n      statusLog(logSection, err.message)\r\n\r\n      throw err\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Method to block know hosts that have some kind of tracking.\r\n   * By blocking those hosts we speed up the crawling.\r\n   * \r\n   * More info: http://winhelp2002.mvps.org/hosts.htm\r\n   */\r\n  private getBlockedHosts = (): object => {\r\n    const blockedHostsArray = blockedHostsList.split('\\n');\r\n\r\n    let blockedHostsObject = blockedHostsArray.reduce((prev, curr) => {\r\n      const frags = curr.split(' ');\r\n\r\n      if (frags.length > 1 && frags[0] === '0.0.0.0') {\r\n        prev[frags[1].trim()] = true;\r\n      }\r\n\r\n      return prev;\r\n    }, {});\r\n\r\n    blockedHostsObject = {\r\n      ...blockedHostsObject,\r\n      'static.chartbeat.com': true,\r\n      'scdn.cxense.com': true,\r\n      'api.cxense.com': true,\r\n      'www.googletagmanager.com': true,\r\n      'connect.facebook.net': true,\r\n      'platform.twitter.com': true,\r\n      'tags.tiqcdn.com': true,\r\n      'dev.visualwebsiteoptimizer.com': true,\r\n      'smartlock.google.com': true,\r\n      'cdn.embedly.com': true\r\n    }\r\n\r\n    return blockedHostsObject;\r\n  }\r\n\r\n  /**\r\n   * Method to complete kill any Puppeteer process still active.\r\n   * Freeing up memory.\r\n   */\r\n  public close = (page?: Page): Promise<void> => {\r\n    return new Promise(async (resolve, reject) => {\r\n      const loggerPrefix = 'close';\r\n\r\n      if (page) {\r\n        try {\r\n          statusLog(loggerPrefix, 'Closing page...');\r\n          await page.close();\r\n          statusLog(loggerPrefix, 'Closed page!');\r\n        } catch (err) {\r\n          reject(err)\r\n        }\r\n      }\r\n\r\n      if (this.browser) {\r\n        try {\r\n          statusLog(loggerPrefix, 'Closing browser...');\r\n          await this.browser.close();\r\n          statusLog(loggerPrefix, 'Closed browser!');\r\n\r\n          const browserProcessPid = this.browser.process().pid;\r\n\r\n          // Completely kill the browser process to prevent zombie processes\r\n          // https://docs.browserless.io/blog/2019/03/13/more-observations.html#tip-2-when-you-re-done-kill-it-with-fire\r\n          if (browserProcessPid) {\r\n            statusLog(loggerPrefix, `Killing browser process pid: ${browserProcessPid}...`);\r\n\r\n            treeKill(browserProcessPid, 'SIGKILL', (err) => {\r\n              if (err) {\r\n                return reject(`Failed to kill browser process pid: ${browserProcessPid}`);\r\n              }\r\n\r\n              statusLog(loggerPrefix, `Killed browser pid: ${browserProcessPid} Closed browser.`);\r\n              resolve()\r\n            });\r\n          }\r\n        } catch (err) {\r\n          reject(err);\r\n        }\r\n      }\r\n\r\n      return resolve()\r\n    })\r\n\r\n  }\r\n\r\n  /**\r\n   * Simple method to check if the session is still active.\r\n   */\r\n  public checkIfLoggedIn = async () => {\r\n    const logSection = 'checkIfLoggedIn';\r\n\r\n    const page = await this.createPage();\r\n\r\n    statusLog(logSection, 'Checking if we are still logged in...')\r\n\r\n    // Go to the login page of LinkedIn\r\n    // If we do not get redirected and stay on /login, we are logged out\r\n    // If we get redirect to /feed, we are logged in\r\n    await page.goto('https://www.linkedin.com/login', {\r\n      waitUntil: 'networkidle2',\r\n      timeout: this.options.timeout\r\n    })\r\n\r\n    const url = page.url()\r\n\r\n    const isLoggedIn = !url.endsWith('/login')\r\n\r\n    await page.close();\r\n\r\n    if (isLoggedIn) {\r\n      statusLog(logSection, 'All good. We are still logged in.')\r\n    } else {\r\n      const errorMessage = 'Bad news, we are not logged in! Your session seems to be expired. Use your browser to login again with your LinkedIn credentials and extract the \"li_at\" cookie value for the \"sessionCookieValue\" option.';\r\n      statusLog(logSection, errorMessage)\r\n      throw new SessionExpired(errorMessage)\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Method to scrape a user profile.\r\n   */\r\n  public run = async (profileUrl: string) => {\r\n    const logSection = 'run'\r\n\r\n    const scraperSessionId = new Date().getTime();\r\n\r\n    if (!this.browser) {\r\n      throw new Error('Browser is not set. Please run the setup method first.')\r\n    }\r\n\r\n    if (!profileUrl) {\r\n      throw new Error('No profileUrl given.')\r\n    }\r\n\r\n    if (!profileUrl.includes('linkedin.com/')) {\r\n      throw new Error('The given URL to scrape is not a linkedin.com url.')\r\n    }\r\n\r\n    try {\r\n      // Eeach run has it's own page\r\n      const page = await this.createPage();\r\n\r\n      statusLog(logSection, `Navigating to LinkedIn profile: ${profileUrl}`, scraperSessionId)\r\n\r\n      await page.goto(profileUrl, {\r\n        // Use \"networkidl2\" here and not \"domcontentloaded\". \r\n        // As with \"domcontentloaded\" some elements might not be loaded correctly, resulting in missing data.\r\n        waitUntil: 'domcontentloaded',\r\n        timeout: this.options.timeout\r\n      });\r\n\r\n      statusLog(logSection, 'LinkedIn profile page loaded!', scraperSessionId)\r\n\r\n      statusLog(logSection, 'Getting all the LinkedIn profile data by scrolling the page to the bottom, so all the data gets loaded into the page...', scraperSessionId)\r\n\r\n      await autoScroll(page);\r\n\r\n      statusLog(logSection, 'Parsing data...', scraperSessionId)\r\n\r\n      // Only click the expanding buttons when they exist\r\n      const expandButtonsSelectors = [\r\n        '.pv-profile-section.pv-about-section .lt-line-clamp__more', // About\r\n        '#experience-section .pv-profile-section__see-more-inline.link', // Experience\r\n        '.pv-profile-section.education-section button.pv-profile-section__see-more-inline', // Education\r\n        '.pv-skill-categories-section [data-control-name=\"skill_details\"]', // Skills\r\n      ];\r\n\r\n      const seeMoreButtonsSelectors = ['.pv-entity__description .lt-line-clamp__line.lt-line-clamp__line--last .lt-line-clamp__more[href=\"#\"]', '.lt-line-clamp__more[href=\"#\"]:not(.lt-line-clamp__ellipsis--dummy)']\r\n\r\n      statusLog(logSection, 'Expanding all sections by clicking their \"See more\" buttons', scraperSessionId)\r\n\r\n      for (const buttonSelector of expandButtonsSelectors) {\r\n        try {\r\n          if (await page.$(buttonSelector) !== null) {\r\n            statusLog(logSection, `Clicking button ${buttonSelector}`, scraperSessionId)\r\n            await page.click(buttonSelector);\r\n          }\r\n        } catch (err) {\r\n          statusLog(logSection, `Could not find or click expand button selector \"${buttonSelector}\". So we skip that one.`, scraperSessionId)\r\n        }\r\n      }\r\n\r\n\r\n      // To give a little room to let data appear. Setting this to 0 might result in \"Node is detached from document\" errors\r\n      await page.waitFor(100);\r\n\r\n      statusLog(logSection, 'Expanding all descriptions by clicking their \"See more\" buttons', scraperSessionId)\r\n\r\n      for (const seeMoreButtonSelector of seeMoreButtonsSelectors) {\r\n        const buttons = await page.$$(seeMoreButtonSelector)\r\n\r\n        for (const button of buttons) {\r\n          if (button) {\r\n            try {\r\n              statusLog(logSection, `Clicking button ${seeMoreButtonSelector}`, scraperSessionId)\r\n              await button.click()\r\n            } catch (err) {\r\n              statusLog(logSection, `Could not find or click see more button selector \"${button}\". So we skip that one.`, scraperSessionId)\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      statusLog(logSection, 'Parsing profile data...', scraperSessionId)\r\n\r\n      const rawUserProfileData: RawProfile = await page.evaluate(() => {\r\n        const profileSection = document.querySelector('#profile-content')\r\n\r\n        const url = window.location.href\r\n\r\n        const fullNameElement = profileSection?.querySelector('.pv-text-details__left-panel h1')\r\n        const fullName = fullNameElement?.textContent || null\r\n\r\n        const titleElement = profileSection?.querySelector('section div.pv-text-details__left-panel div.text-body-medium.break-words')\r\n        const title = titleElement?.textContent || null\r\n\r\n        const locationElement = profileSection?.querySelector('.pv-text-details__left-panel>span.text-body-small')\r\n        const location = locationElement?.textContent || null\r\n\r\n        // const photoElement = profileSection?.querySelector('.pv-top-card__photo>img.pv-top-card-profile-picture__image')// || profileSection?.querySelector('.profile-photo-edit__preview')\r\n        // const photo = (photoElement as HTMLImageElement).currentSrc || null\r\n\r\n        const descriptionElement = profileSection?.querySelector('#about ~ div:nth-child(3)') // Is outside \"profileSection\"\r\n        const description = descriptionElement?.textContent || null\r\n\r\n        return {\r\n          fullName,\r\n          title,\r\n          location,\r\n          // photo,\r\n          description,\r\n          url\r\n        } as RawProfile\r\n      })\r\n\r\n      // Convert the raw data to clean data using our utils\r\n      // So we don't have to inject our util methods inside the browser context, which is too damn difficult using TypeScript\r\n      const userProfile: Profile = {\r\n        ...rawUserProfileData,\r\n        fullName: getCleanText(rawUserProfileData.fullName),\r\n        title: getCleanText(rawUserProfileData.title),\r\n        location: rawUserProfileData.location ? getLocationFromText(rawUserProfileData.location) : null,\r\n        description: getCleanText(rawUserProfileData.description),\r\n      }\r\n\r\n      statusLog(logSection, `Got user profile data: ${JSON.stringify(userProfile)}`, scraperSessionId)\r\n\r\n      statusLog(logSection, `Parsing experiences data...`, scraperSessionId)\r\n\r\n      const rawExperiencesData: RawExperience[] = await page.$$eval('#experience ~ div:nth-child(3) > ul > li', (nodes) => {\r\n        let data: RawExperience[] = []\r\n\r\n        // Using a for loop so we can use await inside of it\r\n        for (const node of nodes) {\r\n          const check_evolucion = node.querySelector(\".pvs-entity__path-node\");\r\n          let titleElement;\r\n          let dateRangeElement;\r\n          let employmentType;\r\n          let company;\r\n          let location;\r\n          if (check_evolucion) {\r\n            const elementos = node.querySelectorAll(\".pvs-entity.pvs-entity--with-path span:first-child\");\r\n            titleElement = elementos[0];\r\n            dateRangeElement = elementos[2];\r\n            const employmentTypeElement = elementos[1];\r\n            employmentType = employmentTypeElement?.textContent\r\n\r\n            const companyElement = node.querySelector(\"span:first-child\");\r\n            company = companyElement?.textContent;\r\n\r\n            const locationElement = node.querySelector(\"div:nth-child(2)>div:first-child span:nth-child(3)>span:first-child\");\r\n            location = locationElement?.textContent?.split(\"·\")[0].trim() || null;\r\n\r\n          } else {\r\n            titleElement = node.querySelector('div.display-flex.align-items-center.mr1.t-bold>span:first-child');\r\n\r\n            const elementos = node.querySelectorAll(\"span.t-14.t-normal>span:first-child\");\r\n            const employmentTypeElement = elementos[0];\r\n            // const companyElement = elementos[1];\r\n            // const descriptionElement = elementos[2];\r\n\r\n            // const employmentTypeElement = node.querySelector('span.pv-entity__secondary-title');\r\n            employmentType = employmentTypeElement?.textContent?.split(\"·\")[1]?.trim() || null\r\n\r\n            // const companyElement = node.querySelector('.pv-entity__secondary-title');\r\n            // const companyElementClean = companyElement && companyElement?.querySelector('span') ? companyElement?.removeChild(companyElement.querySelector('span') as Node) && companyElement : companyElement || null;\r\n            company = employmentTypeElement?.textContent?.split(\"·\")[0]?.trim() || null\r\n\r\n            // const descriptionElement = node.querySelector('.pv-entity__description');\r\n            // const description = descriptionElement?.textContent || null\r\n\r\n            dateRangeElement = elementos[1]; //node.querySelector('.pv-entity__date-range span:nth-child(2)');\r\n\r\n\r\n            const locationElement = elementos[2]; //node.querySelector('.pv-entity__location span:nth-child(2)');\r\n            location = locationElement?.textContent?.split(\"·\")[0].trim() || null;\r\n          }\r\n          const title = titleElement?.textContent || null\r\n          const dateRangeText = dateRangeElement?.textContent || null\r\n\r\n          const startDatePart = dateRangeText?.split('-')[0] || null;\r\n          const startDate = startDatePart?.trim() || null;\r\n\r\n          const endDatePart = dateRangeText?.split('-')[1]?.split(\"·\")[0] || null;\r\n          const endDateIsPresent = endDatePart?.trim().toLowerCase() === 'present' || false;\r\n          const endDate = (endDatePart && !endDateIsPresent) ? endDatePart.trim() : 'Present';\r\n\r\n          data.push({\r\n            title,\r\n            company,\r\n            employmentType,\r\n            location,\r\n            startDate,\r\n            endDate,\r\n            endDateIsPresent,\r\n            description: null\r\n          })\r\n        }\r\n\r\n        return data;\r\n      });\r\n\r\n      // Convert the raw data to clean data using our utils\r\n      // So we don't have to inject our util methods inside the browser context, which is too damn difficult using TypeScript\r\n      const experiences: Experience[] = rawExperiencesData.map((rawExperience) => {\r\n        const startDate = formatDate(rawExperience.startDate);\r\n        const endDate = formatDate(rawExperience.endDate) || null;\r\n        const endDateIsPresent = rawExperience.endDateIsPresent;\r\n\r\n        const durationInDaysWithEndDate = (startDate && endDate && !endDateIsPresent) ? getDurationInDays(startDate, endDate) : null\r\n        const durationInDaysForPresentDate = (endDateIsPresent && startDate) ? getDurationInDays(startDate, new Date()) : null\r\n        const durationInDays = endDateIsPresent ? durationInDaysForPresentDate : durationInDaysWithEndDate;\r\n\r\n        return {\r\n          ...rawExperience,\r\n          title: getCleanText(rawExperience.title),\r\n          company: getCleanText(rawExperience.company),\r\n          employmentType: getCleanText(rawExperience.employmentType),\r\n          location: rawExperience?.location ? getLocationFromText(rawExperience.location) : null,\r\n          startDate,\r\n          endDate,\r\n          endDateIsPresent,\r\n          durationInDays,\r\n          description: getCleanText(rawExperience.description)\r\n        }\r\n      })\r\n\r\n      statusLog(logSection, `Got experiences data: ${JSON.stringify(experiences)}`, scraperSessionId)\r\n\r\n      statusLog(logSection, `Parsing education data...`, scraperSessionId)\r\n\r\n      const rawEducationData: RawEducation[] = await page.$$eval('#education-section ul > .ember-view', (nodes) => {\r\n        // Note: the $$eval context is the browser context.\r\n        // So custom methods you define in this file are not available within this $$eval.\r\n        let data: RawEducation[] = []\r\n        for (const node of nodes) {\r\n\r\n          const schoolNameElement = node.querySelector('h3.pv-entity__school-name');\r\n          const schoolName = schoolNameElement?.textContent || null;\r\n\r\n          const degreeNameElement = node.querySelector('.pv-entity__degree-name .pv-entity__comma-item');\r\n          const degreeName = degreeNameElement?.textContent || null;\r\n\r\n          const fieldOfStudyElement = node.querySelector('.pv-entity__fos .pv-entity__comma-item');\r\n          const fieldOfStudy = fieldOfStudyElement?.textContent || null;\r\n\r\n          // const gradeElement = node.querySelector('.pv-entity__grade .pv-entity__comma-item');\r\n          // const grade = (gradeElement && gradeElement.textContent) ? window.getCleanText(fieldOfStudyElement.textContent) : null;\r\n\r\n          const dateRangeElement = node.querySelectorAll('.pv-entity__dates time');\r\n\r\n          const startDatePart = dateRangeElement && dateRangeElement[0]?.textContent || null;\r\n          const startDate = startDatePart || null\r\n\r\n          const endDatePart = dateRangeElement && dateRangeElement[1]?.textContent || null;\r\n          const endDate = endDatePart || null\r\n\r\n          data.push({\r\n            schoolName,\r\n            degreeName,\r\n            fieldOfStudy,\r\n            startDate,\r\n            endDate\r\n          })\r\n        }\r\n\r\n        return data\r\n      });\r\n\r\n      // Convert the raw data to clean data using our utils\r\n      // So we don't have to inject our util methods inside the browser context, which is too damn difficult using TypeScript\r\n      const education: Education[] = rawEducationData.map(rawEducation => {\r\n        const startDate = formatDate(rawEducation.startDate)\r\n        const endDate = formatDate(rawEducation.endDate)\r\n\r\n        return {\r\n          ...rawEducation,\r\n          schoolName: getCleanText(rawEducation.schoolName),\r\n          degreeName: getCleanText(rawEducation.degreeName),\r\n          fieldOfStudy: getCleanText(rawEducation.fieldOfStudy),\r\n          startDate,\r\n          endDate,\r\n          durationInDays: getDurationInDays(startDate, endDate),\r\n        }\r\n      })\r\n\r\n      statusLog(logSection, `Got education data: ${JSON.stringify(education)}`, scraperSessionId)\r\n\r\n      statusLog(logSection, `Parsing volunteer experience data...`, scraperSessionId)\r\n\r\n      const rawVolunteerExperiences: RawVolunteerExperience[] = await page.$$eval('.pv-profile-section.volunteering-section ul > li.ember-view', (nodes) => {\r\n        // Note: the $$eval context is the browser context.\r\n        // So custom methods you define in this file are not available within this $$eval.\r\n        let data: RawVolunteerExperience[] = []\r\n        for (const node of nodes) {\r\n\r\n          const titleElement = node.querySelector('.pv-entity__summary-info h3');\r\n          const title = titleElement?.textContent || null;\r\n\r\n          const companyElement = node.querySelector('.pv-entity__summary-info span.pv-entity__secondary-title');\r\n          const company = companyElement?.textContent || null;\r\n\r\n          const dateRangeElement = node.querySelector('.pv-entity__date-range span:nth-child(2)');\r\n          const dateRangeText = dateRangeElement?.textContent || null\r\n          const startDatePart = dateRangeText?.split('–')[0] || null;\r\n          const startDate = startDatePart?.trim() || null;\r\n\r\n          const endDatePart = dateRangeText?.split('–')[1] || null;\r\n          const endDateIsPresent = endDatePart?.trim().toLowerCase() === 'present' || false;\r\n          const endDate = (endDatePart && !endDateIsPresent) ? endDatePart.trim() : 'Present';\r\n\r\n          const descriptionElement = node.querySelector('.pv-entity__description')\r\n          const description = descriptionElement?.textContent || null;\r\n\r\n          data.push({\r\n            title,\r\n            company,\r\n            startDate,\r\n            endDate,\r\n            endDateIsPresent,\r\n            description\r\n          })\r\n        }\r\n\r\n        return data\r\n      });\r\n\r\n      // Convert the raw data to clean data using our utils\r\n      // So we don't have to inject our util methods inside the browser context, which is too damn difficult using TypeScript\r\n      const volunteerExperiences: VolunteerExperience[] = rawVolunteerExperiences.map(rawVolunteerExperience => {\r\n        const startDate = formatDate(rawVolunteerExperience.startDate)\r\n        const endDate = formatDate(rawVolunteerExperience.endDate)\r\n\r\n        return {\r\n          ...rawVolunteerExperience,\r\n          title: getCleanText(rawVolunteerExperience.title),\r\n          company: getCleanText(rawVolunteerExperience.company),\r\n          description: getCleanText(rawVolunteerExperience.description),\r\n          startDate,\r\n          endDate,\r\n          durationInDays: getDurationInDays(startDate, endDate),\r\n        }\r\n      })\r\n\r\n      statusLog(logSection, `Got volunteer experience data: ${JSON.stringify(volunteerExperiences)}`, scraperSessionId)\r\n\r\n      statusLog(logSection, `Parsing skills data...`, scraperSessionId)\r\n\r\n      const skills: Skill[] = await page.$$eval('.pv-skill-categories-section ol > .ember-view', nodes => {\r\n        // Note: the $$eval context is the browser context.\r\n        // So custom methods you define in this file are not available within this $$eval.\r\n\r\n        return nodes.map((node) => {\r\n          const skillName = node.querySelector('.pv-skill-category-entity__name-text');\r\n          const endorsementCount = node.querySelector('.pv-skill-category-entity__endorsement-count');\r\n\r\n          return {\r\n            skillName: (skillName) ? skillName.textContent?.trim() : null,\r\n            endorsementCount: (endorsementCount) ? parseInt(endorsementCount.textContent?.trim() || '0') : 0\r\n          } as Skill;\r\n        }) as Skill[]\r\n      });\r\n\r\n      statusLog(logSection, `Got skills data: ${JSON.stringify(skills)}`, scraperSessionId)\r\n\r\n      statusLog(logSection, `Done! Returned profile details for: ${profileUrl}`, scraperSessionId)\r\n\r\n      if (!this.options.keepAlive) {\r\n        statusLog(logSection, 'Not keeping the session alive.')\r\n\r\n        await this.close(page)\r\n\r\n        statusLog(logSection, 'Done. Puppeteer is closed.')\r\n      } else {\r\n        statusLog(logSection, 'Done. Puppeteer is being kept alive in memory.')\r\n\r\n        // Only close the current page, we do not need it anymore\r\n        await page.close()\r\n      }\r\n\r\n      return {\r\n        userProfile,\r\n        experiences,\r\n        education,\r\n        volunteerExperiences,\r\n        skills\r\n      }\r\n    } catch (err) {\r\n      // Kill Puppeteer\r\n      await this.close()\r\n\r\n      statusLog(logSection, 'An error occurred during a run.')\r\n\r\n      // Throw the error up, allowing the user to handle this error himself.\r\n      throw err;\r\n    }\r\n  }\r\n}\r\n"]}